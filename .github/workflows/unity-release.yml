name: Unity Package Release

on:
  push:
    tags:
      - '*'

jobs:
  create-unity-package:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Required for creating releases
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Setup Node.js for version sync
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          
      - name: Sync versions from central config
        run: |
          echo "ðŸ”„ Syncing versions from version.json..."
          node scripts/sync-versions.js
          
      - name: Export Unity Package (.unitypackage)
        uses: game-ci/unity-builder@v4
        env:
          UNITY_LICENSE: ${{ secrets.UNITY_LICENSE }}
        with:
          projectPath: unity
          unityVersion: 2021.3.0f1
          targetPlatform: StandaloneLinux64
          customParameters: -quit -batchmode -nographics -exportPackage "Assets/GamePulse" "../Gamepulse-${GITHUB_REF_NAME}.unitypackage"
          
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          name: Gamepulse SDK ${{ github.ref_name }}
          body: |
            ## Gamepulse SDK ${{ github.ref_name }}
            
            ### ðŸ“¦ Downloads
            - **Unity**: Download `Gamepulse-${{ github.ref_name }}.unitypackage` below
            - **Android**: `com.github.gamepulse:gamepulse-sdk:${{ github.ref_name }}`
            - **Web/JS**: `@gamepulse/web-sdk@${{ github.ref_name }}`
            
            ### ðŸ”— Direct Download URL
            ```
            https://github.com/gamepulse/gamepulse-sdk/releases/download/${{ github.ref_name }}/Gamepulse-${{ github.ref_name }}.unitypackage
            ```
            
            ### ðŸ“– Documentation
            - [Unity Integration Guide](https://github.com/gamepulse/gamepulse-sdk/blob/main/unity/README.md)
            - [Android Integration Guide](https://github.com/gamepulse/gamepulse-sdk/blob/main/android/README.md)
            - [Web Integration Guide](https://github.com/gamepulse/gamepulse-sdk/blob/main/web/README.md)
            
            ### âœ¨ What's New
            See the [CHANGELOG](https://github.com/gamepulse/gamepulse-sdk/blob/main/CHANGELOG.md) for details.
          files: |
            Gamepulse-${{ github.ref_name }}.unitypackage
          draft: false
          prerelease: false
