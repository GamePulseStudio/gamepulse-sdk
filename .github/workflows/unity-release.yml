name: Unity Package Release

on:
  push:
    tags:
      - '*'

jobs:
  create-unity-package:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # Required for creating releases
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        
      - name: Create Unity Package
        run: |
          cd packages/unity-package
          
          # Create the .unitypackage using Unity's packaging
          # For now, we'll create a zip file as a .unitypackage (they're the same format)
          zip -r "GameAlytics-${GITHUB_REF_NAME}.unitypackage" Assets/ -x "*.meta~" "*.tmp"
          
          # Move to root for release upload
          mv "GameAlytics-${GITHUB_REF_NAME}.unitypackage" ../../
          
      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          name: GameAlytics SDK ${{ github.ref_name }}
          body: |
            ## GameAlytics SDK ${{ github.ref_name }}
            
            ### ðŸ“¦ Downloads
            - **Unity**: Download `GameAlytics-${{ github.ref_name }}.unitypackage` below
            - **Android**: `com.github.gamealytics:gamealytics-sdk:${{ github.ref_name }}`
            - **Web/JS**: `@gamealytics/web-sdk@${{ github.ref_name }}`
            
            ### ðŸ”— Direct Download URL
            ```
            https://github.com/gamealytics/gamealytics-sdk/releases/download/${{ github.ref_name }}/GameAlytics-${{ github.ref_name }}.unitypackage
            ```
            
            ### ðŸ“– Documentation
            - [Unity Integration Guide](https://github.com/gamealytics/gamealytics-sdk/blob/main/packages/unity-package/Assets/GameAlytics/Documentation/README.md)
            - [Android Integration Guide](https://github.com/gamealytics/gamealytics-sdk/blob/main/packages/android/README.md)
            - [Web Integration Guide](https://github.com/gamealytics/gamealytics-sdk/blob/main/packages/web/README.md)
            
            ### âœ¨ What's New
            See the [CHANGELOG](https://github.com/gamealytics/gamealytics-sdk/blob/main/CHANGELOG.md) for details.
          files: |
            GameAlytics-${{ github.ref_name }}.unitypackage
          draft: false
          prerelease: false
